{% extends 'base.html.twig' %}

{% block meta_tags %}
	<meta name="description" content="{% for rock in rocks %}{{ rock.rockDescription}}{% endfor %}"/>
	<meta name="robots" content="index,follow"/>
	<meta property="og:site_name" content="Munichclimbs | {{ areaName }} | {{ rockName }}">
	<meta property="og:title" content="Munichclimbs | {{ areaName }} | {{ rockName }}"/>
	<meta property="og:type" content="website"/>
	<meta property="og:url" content="https://munichclimbs.de/Kletterfels/{{ slug }}"/>
	<meta property="og:description" content="{% for rock in rocks %}{{ rock.rockDescription}}{% endfor %}"/>
	<meta name="keywords" content="Klettertouren Burgstein: {% for route in routes %}{{ route.routeName}} {{ route.routeGrade}}{% if loop.last == false  %}, {% else %}{% endif %}{% endfor %}"/>
{% endblock %}

{% block title %}Munichclimbs |
	{{ areaName }}
	|
	{{ slug|custom_replace }}
{% endblock %}

{# {% block body_attributes %}
	data-bs-spy="scroll" data-bs-target="#topo-anker" data-bs-root-margin="0px 0px -40%" data-bs-smooth-scroll="true" class="scrollspy-example" tabindex="0"
{% endblock %} #}

{% block body %}
	{{ include('partials/_navigation.html.twig') }}
	<main>
		{% for rock in rocks %}
			<div class="container my-3">
				<section>
					<div class="bg-image py-3 rounded d-flex align-items-start background-image-height" style="background-image: url('https://www.munichclimbs.de/build/images/headerImages/{{ rock.rockheaderImage }}.webp')">
						<div class="p-3 shadow-3 alert-light d-flex justify-content-between w-100" style="background-color: rgba(255, 255, 255, 0.6);">
							<h1 class="h2 mb-0 fw-bold text-black ">
								{{ rock.rockName }}
								<nav class="mt-1" aria-label="breadcrumb">
									<ol class="breadcrumb text-black fw-normal mb-0" style="font-size: 12px">
										<li class="breadcrumb-item">
											<a class="text-primary" href="{{path('index')}}">
												<span class="home d-inline-block"></span>
											</a>
										</li>
										<li class="breadcrumb-item">
											<a href="{{ path('show_rocks', { slug: rock.areaSlug }) }}">{{ rock.areaName }}</a>
										</li>
										<li class="breadcrumb-item active text-black" aria-current="page">{{ rock.rockName }}</li>
									</ol>
								</nav>
							</h1>
							<div class="d-flex items-center align-self-start">
								<div {{ stimulus_controller('modal-form') }}>
									<button class="btn btn-sm btn-white bg-white p-0 border-0 shadow-none rounded-circle" data-action="modal-form#openModal">
										<div class="info"></div>
									</button>
									{{ include('pageParts/_modal.html.twig', [ rocks ]) }}
								</div>
								<div class="ms-2">
									{% include 'partials/_collapseMap.html.twig' with { collapseId: 'collapseRockMap', ariaControls: 'collapseRockMap' } %}
								</div>
								{% if jsonData %}
									<div data-controller="gallery" data-gallery-data="{{ jsonData|json_encode }}" class="ms-2 d-inline-block">
										<button id="open-gallery-btn" class="btn btn-sm btn-primary p-1 rounded-circle shadow">
											<div class="image-gallery"></div>
										</button>
									</div>
								{% endif %}
							</div>
						</div>
					</div>
					<div class="collapse mt-3" id="collapseRockMap">
						<div id="rockMap" class="z-10 mb-3" style="width: 100%; height: 500px;">
							{{ include('partials/_rockMap.html.twig') }}
						</div>
					</div>
				</section>
			</div>
			{% if topos is not empty %}

				<div class="bg-white border-top border-bottom sticky-top" style="top: 50px;">

					<div class="scrollable-tabs-container container " {{ stimulus_controller('tabs') }}>
						<div class="left-arrow">
							<svg data-slot="icon" fill="none" stroke-width="1.5" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
								<path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5"></path>
							</svg>
						</div>
						<ul class="p-0">
							{% for topo in topos %}
								<li>
									<a class="d-inline-block py-2 text-black fw-medium" href="#{{ topo.topoName|custom_replace }}">{{ topo.topoName }}</a>
								</li>
							{% endfor %}
						</ul>
						<div class="right-arrow active">
							<svg data-slot="icon" fill="none" stroke-width="1.5" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
								<path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5"></path>
							</svg>
						</div>
					</div>

				</div>
			{% endif %}

			<section class="container">
				<div class="row">
					<div class="col-md-12">
						{% set currentDate =  "now"|date("z") %}
						{% if rock.rockBanned == 1 and currentDate < 181 %}
							<div class="alert alert-danger my-3" role="alert">
								<strong class="font-bold">Jahreszeitliche Sperrung!</strong>
								<span class="block sm:inline">{{ rock.rockName }}
									ist leider noch bis zum 30.06. gesperrt!</span>
							</div>
						{% endif %}
					</div>
				</div>
			</section>
		{% endfor %}
		<div class="container">
			<div class="row">
				<div class="col-md-9">
					<section>
						{% set groupedRoutes = {} %}
						{% for routeData in routes %}
							{% set topoName = routeData.topoName %}
							{% set topoNumber = routeData.topoNumber %}
							{% set topoSvg = routeData.topoSvg %}
							{% 
									set groupedRoutes = groupedRoutes|merge({
										(topoName): groupedRoutes[topoName]|default([])|merge([{'routeName': routeData.routeName, 'routeRating': routeData.routeRating, 'routeProtection': routeData.routeProtection, 'areaId': routeData.areaId, 'rockId': routeData.rockId, 'routeId': routeData.routeId, 'routefirstAscent': routeData.routefirstAscent, 'routeyearFirstAscent': routeData.routeyearFirstAscent, 'routeDescription': routeData.routeDescription, 'routeGrade': routeData.routeGrade, 'topoSvg': routeData.topoSvg}])
									}) 
								%}
						{% endfor %}
						{% for topoName, routes in groupedRoutes %}
							<div class="card mt-3 overflow-hidden" id="{{ topoName|custom_replace}}">
								<div class="card-body p-0">
									<section>
										<h3 class="pb-md-1 px-2 py-3">{{ topoName }}</h3>
										{% set hasPrinted = false %}
										{% for route in routes %}
											{% if not hasPrinted %}
												{% if route.topoSvg is not empty %}
													{{ route.topoSvg|raw }}
												{% endif %}
												{% set hasPrinted = true %}
											{% endif %}
										{% endfor %}
										<table class="table table-striped mb-0">
											<tbody>
												{% for route in routes %}
													<tr>
														<td>{{loop.index}}</td>
														<td>
															<div class="d-flex items-bottom">
																<span class="me-1 fw-medium">{{ route.routeName }}
																</span>
																<span data-controller="routeparams" data-routeparams-rating="{{ route.routeRating }}" data-routeparams-protection="{{ route.routeProtection }}">
																	<span data-routeparams-target="star"></span>
																	<span data-routeparams-target="protection"></span>
																</span>
																{% set videos = videoRepository.findVideosByParams(route.areaId, route.rockId, route.routeId) %}
																{% if videos is not empty %}
																	{% for video in videos %}
																		<a href="{{ video.videoLink }}" alt="Video von Route {{ route.routeName }} " target="_blank">
																			<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewbox="0 0 24 24" class="text-black"><path fill="currentColor" d="M15 8v8H5V8h10m1-2H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4V7c0-.55-.45-1-1-1z"/></svg>
																		</a>
																	{% endfor %}
																{% endif %}
															</div>
														</td>
														<td>
															<span class="fw-medium">{{ route.routeGrade }}</span>
														</td>
														<td class="d-none d-lg-table-cell" style="white-space: nowrap;">
															{{ route.routefirstAscent }}
															{% if route.routeyearFirstAscent %}
																{{ route.routeyearFirstAscent }}
															{% endif %}
														</td>
														<td>
															{% if route.routeDescription %}
																<div {{ stimulus_controller('modal-route-information') }}>
																	<button class="btn btn-sm btn-white bg-white p-0 border-0 shadow-none rounded-circle" data-action="modal-route-information#openModal" data-bs-toggle="modal" data-bs-target="#{{ route.routeName|custom_replace }}">
																		<div class="info" style="width: 22px; height: 22px"></div>
																	</button>
																	{{ include('partials/_modal-route-information.html.twig') }}
																</div>
															{% endif %}
														</td>
													</tr>
												{% endfor %}
											</tbody>
										</table>
									</section>
								</div>
							</div>
						{% endfor %}
					</section>
				</div>
			</div>
		</div>
	</div>
	{% include 'partials/_footer.html.twig' with {'areas': areas} %}
</main>{% endblock %}
